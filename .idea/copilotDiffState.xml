<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/VIDEO_UPLOAD_IMPLEMENTATION.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/VIDEO_UPLOAD_IMPLEMENTATION.md" />
              <option name="updatedContent" value="# Video Upload Modal Implementation&#10;&#10;## Overview&#10;I've successfully implemented a video upload modal for the video screen (position 1) in the LibraryContentFragment. The implementation follows the specified workflow: Cloudinary API upload → MediaFile API creation.&#10;&#10;## Files Created/Modified&#10;&#10;### New Files Created:&#10;1. **`dialog_upload_video.xml`** - Modal layout with video selection, progress indicators, and upload controls&#10;2. **`VideoUploadManager.java`** - Handles the upload workflow (Cloudinary → MediaFile API)&#10;3. **`button_background.xml`** - Styled button background drawable&#10;4. **`ic_upload.xml`** - Upload icon for the FloatingActionButton&#10;&#10;### Modified Files:&#10;1. **`fragment_library_content.xml`** - Added FloatingActionButton for video upload&#10;2. **`LibraryContentFragment.java`** - Added upload functionality and modal handling&#10;3. **`AndroidManifest.xml`** - Added READ_EXTERNAL_STORAGE permission&#10;&#10;## Implementation Details&#10;&#10;### Video Upload Workflow:&#10;1. **File Selection**: User taps FAB → opens video picker → selects video file&#10;2. **Cloudinary Upload**: Selected video is uploaded to Cloudinary API&#10;3. **MediaFile Creation**: Using the Cloudinary response URL, creates MediaFile via MediaFile API&#10;4. **UI Update**: Refreshes video list to show the newly uploaded video&#10;&#10;### JSON Format Used:&#10;The MediaFile creation follows the specified format:&#10;```json&#10;{&#10;  &quot;fileUrl&quot;: &quot;string&quot;,     // From Cloudinary response&#10;  &quot;fileName&quot;: &quot;string&quot;,    // Original file name&#10;  &quot;fileType&quot;: &quot;video&quot;,     // Fixed value&#10;  &quot;Author&quot;: &quot;user_id&quot;      // From JWT token via TokenManager&#10;}&#10;```&#10;&#10;### Key Features:&#10;- **Visual Feedback**: Progress indicators and status messages during upload&#10;- **Error Handling**: Comprehensive error handling with user-friendly messages&#10;- **File Validation**: Ensures proper video file selection&#10;- **User Experience**: Modal-based upload with cancel functionality&#10;- **Integration**: Seamlessly integrates with existing video list display&#10;&#10;### Modal UI Components:&#10;- File selection button&#10;- Selected file display&#10;- Progress bar with status text&#10;- Upload and cancel buttons&#10;- Vietnamese language support&#10;&#10;### Technical Implementation:&#10;- **ActivityResultLauncher**: Modern Android file picker implementation&#10;- **Async Upload**: Non-blocking upload with callback-based progress updates&#10;- **JWT Integration**: Automatic user ID extraction from stored JWT token&#10;- **REST API Integration**: Proper error handling for both Cloudinary and MediaFile APIs&#10;&#10;## Usage&#10;1. Navigate to the Video tab (position 1)&#10;2. Tap the upload FAB (floating action button)&#10;3. Select a video file from device storage&#10;4. Tap &quot;Tải lên&quot; (Upload) to start the upload process&#10;5. Wait for completion - the video list will automatically refresh&#10;&#10;The implementation is now complete and ready for testing. The video upload modal will only appear in the video screen (position 1) and provides a seamless way for users to upload videos through the Cloudinary and MediaFile APIs as requested." />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/notby/data/model/Article.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/notby/data/model/Article.java" />
              <option name="originalContent" value="package com.example.notby.data.model;&#10;&#10;import com.google.gson.JsonElement;&#10;import com.google.gson.JsonObject;&#10;import com.google.gson.annotations.SerializedName;&#10;import java.util.List;&#10;&#10;public class Article {&#10;    @SerializedName(&quot;_id&quot;)&#10;    private String id;&#10;&#10;    @SerializedName(&quot;CategoryId&quot;)&#10;    private String categoryId;&#10;&#10;    @SerializedName(&quot;Title&quot;)&#10;    private String title;&#10;&#10;    @SerializedName(&quot;Content&quot;)&#10;    private String content;&#10;&#10;    @SerializedName(&quot;FileId&quot;)&#10;    private String fileId;&#10;&#10;    @SerializedName(&quot;Author&quot;)&#10;    private JsonElement author; // can be String, object, or null&#10;&#10;    @SerializedName(&quot;Description&quot;)&#10;    private String description;&#10;&#10;    @SerializedName(&quot;File&quot;)&#10;    private MediaFile file;&#10;&#10;    @SerializedName(&quot;Category&quot;)&#10;    private Category category;&#10;&#10;    @SerializedName(&quot;Likes&quot;)&#10;    private int likes;&#10;&#10;    @SerializedName(&quot;Views&quot;)&#10;    private int views;&#10;&#10;    @SerializedName(&quot;Tags&quot;)&#10;    private List&lt;String&gt; tags;&#10;&#10;    @SerializedName(&quot;ReadTime&quot;)&#10;    private int readTime;&#10;&#10;    @SerializedName(&quot;created_at&quot;)&#10;    private String createdAt;&#10;&#10;    @SerializedName(&quot;updated_at&quot;)&#10;    private String updatedAt;&#10;&#10;    // Getters&#10;    public String getId() { return id; }&#10;    public String getCategoryId() { return categoryId; }&#10;    public String getTitle() { return title; }&#10;    public String getContent() { return content; }&#10;    public String getFileId() { return fileId; }&#10;    public String getAuthorId() {&#10;        if (author == null || author.isJsonNull()) return null;&#10;        if (author.isJsonPrimitive()) {&#10;            try { return author.getAsString(); } catch (Exception e) { return null; }&#10;        }&#10;        if (author.isJsonObject()) {&#10;            JsonObject obj = author.getAsJsonObject();&#10;            if (obj.has(&quot;_id&quot;) &amp;&amp; !obj.get(&quot;_id&quot;).isJsonNull()) return obj.get(&quot;_id&quot;).getAsString();&#10;            if (obj.has(&quot;id&quot;) &amp;&amp; !obj.get(&quot;id&quot;).isJsonNull()) return obj.get(&quot;id&quot;).getAsString();&#10;        }&#10;        return null;&#10;    }&#10;    public String getDescription() { return description; }&#10;    public MediaFile getFile() { return file; }&#10;    public Category getCategory() { return category; }&#10;    public int getLikes() { return likes; }&#10;    public int getViews() { return views; }&#10;    public List&lt;String&gt; getTags() { return tags; }&#10;    public int getReadTime() { return readTime; }&#10;    public String getCreatedAt() { return createdAt; }&#10;    public String getUpdatedAt() { return updatedAt; }&#10;    public JsonElement getAuthor() { return author; }&#10;&#10;    // Setters&#10;    public void setId(String id) { this.id = id; }&#10;    public void setCategoryId(String categoryId) { this.categoryId = categoryId; }&#10;    public void setTitle(String title) { this.title = title; }&#10;    public void setContent(String content) { this.content = content; }&#10;    public void setFileId(String fileId) { this.fileId = fileId; }&#10;    public void setAuthor(JsonElement author) { this.author = author; }&#10;    public void setDescription(String description) { this.description = description; }&#10;    public void setFile(MediaFile file) { this.file = file; }&#10;    public void setCategory(Category category) { this.category = category; }&#10;    public void setLikes(int likes) { this.likes = likes; }&#10;    public void setViews(int views) { this.views = views; }&#10;    public void setTags(List&lt;String&gt; tags) { this.tags = tags; }&#10;    public void setReadTime(int readTime) { this.readTime = readTime; }&#10;    public void setCreatedAt(String createdAt) { this.createdAt = createdAt; }&#10;    public void setUpdatedAt(String updatedAt) { this.updatedAt = updatedAt; }&#10;&#10;    // Get image URL helper method&#10;    public String getImageUrl() {&#10;        return file != null ? file.getFileUrl() : null;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.notby.data.model;&#10;&#10;import com.google.gson.JsonElement;&#10;import com.google.gson.JsonObject;&#10;import com.google.gson.annotations.SerializedName;&#10;import java.util.List;&#10;&#10;public class Article {&#10;    @SerializedName(&quot;_id&quot;)&#10;    private String id;&#10;&#10;    @SerializedName(&quot;CategoryId&quot;)&#10;    private String categoryId;&#10;&#10;    @SerializedName(&quot;Title&quot;)&#10;    private String title;&#10;&#10;    @SerializedName(&quot;Content&quot;)&#10;    private String content;&#10;&#10;    @SerializedName(&quot;FileId&quot;)&#10;    private String fileId;&#10;&#10;    @SerializedName(&quot;Author&quot;)&#10;    private JsonElement author; // can be String, object, or null&#10;&#10;    @SerializedName(&quot;Description&quot;)&#10;    private String description;&#10;&#10;    @SerializedName(&quot;File&quot;)&#10;    private MediaFile file;&#10;&#10;    @SerializedName(&quot;Category&quot;)&#10;    private Category category;&#10;&#10;    @SerializedName(&quot;Likes&quot;)&#10;    private int likes;&#10;&#10;    @SerializedName(&quot;Views&quot;)&#10;    private int views;&#10;&#10;    @SerializedName(&quot;Tags&quot;)&#10;    private List&lt;String&gt; tags;&#10;&#10;    @SerializedName(&quot;ReadTime&quot;)&#10;    private int readTime;&#10;&#10;    @SerializedName(&quot;created_at&quot;)&#10;    private String createdAt;&#10;&#10;    @SerializedName(&quot;updated_at&quot;)&#10;    private String updatedAt;&#10;&#10;    // Getters&#10;    public String getId() { return id; }&#10;    public String getCategoryId() { return categoryId; }&#10;    public String getTitle() { return title; }&#10;    public String getContent() { return content; }&#10;    public String getFileId() { return fileId; }&#10;    public String getAuthorId() {&#10;        if (author == null || author.isJsonNull()) return null;&#10;        if (author.isJsonPrimitive()) {&#10;            try { return author.getAsString(); } catch (Exception e) { return null; }&#10;        }&#10;        if (author.isJsonObject()) {&#10;            JsonObject obj = author.getAsJsonObject();&#10;            if (obj.has(&quot;_id&quot;) &amp;&amp; !obj.get(&quot;_id&quot;).isJsonNull()) return obj.get(&quot;_id&quot;).getAsString();&#10;            if (obj.has(&quot;id&quot;) &amp;&amp; !obj.get(&quot;id&quot;).isJsonNull()) return obj.get(&quot;id&quot;).getAsString();&#10;        }&#10;        return null;&#10;    }&#10;    public String getDescription() { return description; }&#10;    public MediaFile getFile() { return file; }&#10;    public Category getCategory() { return category; }&#10;    public int getLikes() { return likes; }&#10;    public int getViews() { return views; }&#10;    public List&lt;String&gt; getTags() { return tags; }&#10;    public int getReadTime() { return readTime; }&#10;    public String getCreatedAt() { return createdAt; }&#10;    public String getUpdatedAt() { return updatedAt; }&#10;    public JsonElement getAuthor() { return author; }&#10;&#10;    // Setters&#10;    public void setId(String id) { this.id = id; }&#10;    public void setCategoryId(String categoryId) { this.categoryId = categoryId; }&#10;    public void setTitle(String title) { this.title = title; }&#10;    public void setContent(String content) { this.content = content; }&#10;    public void setFileId(String fileId) { this.fileId = fileId; }&#10;    public void setAuthor(JsonElement author) { this.author = author; }&#10;    public void setDescription(String description) { this.description = description; }&#10;    public void setFile(MediaFile file) { this.file = file; }&#10;    public void setCategory(Category category) { this.category = category; }&#10;    public void setLikes(int likes) { this.likes = likes; }&#10;    public void setViews(int views) { this.views = views; }&#10;    public void setTags(List&lt;String&gt; tags) { this.tags = tags; }&#10;    public void setReadTime(int readTime) { this.readTime = readTime; }&#10;    public void setCreatedAt(String createdAt) { this.createdAt = createdAt; }&#10;    public void setUpdatedAt(String updatedAt) { this.updatedAt = updatedAt; }&#10;&#10;    // Get image URL helper method&#10;    public String getImageUrl() {&#10;        return file != null ? file.getFileUrl() : null;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/notby/ui/library/LibraryAdapter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/notby/ui/library/LibraryAdapter.java" />
              <option name="originalContent" value="package com.example.notby.ui.library;&#10;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.TextView;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.bumptech.glide.Glide;&#10;import com.example.notby.R;&#10;import com.example.notby.data.model.Article;&#10;import com.example.notby.data.model.MediaFile;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class LibraryAdapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; {&#10;    private static final int TYPE_ARTICLE = 0;&#10;    private static final int TYPE_VIDEO = 1;&#10;    private static final int TYPE_DOCUMENT = 2;&#10;    private List&lt;Article&gt; articles = new ArrayList&lt;&gt;();&#10;    private List&lt;MediaFile&gt; videos = new ArrayList&lt;&gt;();&#10;    private List&lt;MediaFile&gt; documents = new ArrayList&lt;&gt;();&#10;    private OnArticleClickListener articleListener;&#10;    private OnVideoClickListener videoListener;&#10;    private OnDocumentClickListener documentListener;&#10;&#10;    public interface OnArticleClickListener {&#10;        void onArticleClick(Article article);&#10;    }&#10;    public interface OnVideoClickListener {&#10;        void onVideoClick(MediaFile video);&#10;    }&#10;    public interface OnDocumentClickListener {&#10;        void onDocumentClick(MediaFile document);&#10;    }&#10;    public void setOnArticleClickListener(OnArticleClickListener listener) {&#10;        this.articleListener = listener;&#10;    }&#10;    public void setOnVideoClickListener(OnVideoClickListener listener) {&#10;        this.videoListener = listener;&#10;    }&#10;    public void setOnDocumentClickListener(OnDocumentClickListener listener) {&#10;        this.documentListener = listener;&#10;    }&#10;    public void setArticles(List&lt;Article&gt; articles) {&#10;        this.articles = articles;&#10;        this.videos.clear();&#10;        this.documents.clear();&#10;        notifyDataSetChanged();&#10;    }&#10;&#10;    // Insert a newly created article at the front of the list and notify adapter.&#10;    public void addArticleAtFront(Article article) {&#10;        if (article == null) return;&#10;        if (articles == null) articles = new ArrayList&lt;&gt;();&#10;        articles.add(0, article);&#10;        // ensure other lists are cleared because this adapter shows one type at a time&#10;        this.videos.clear();&#10;        this.documents.clear();&#10;        // Dataset type changed (was maybe video/document), safer to refresh whole adapter&#10;        notifyDataSetChanged();&#10;    }&#10;    public void setVideos(List&lt;MediaFile&gt; videos) {&#10;        this.videos = videos;&#10;        this.articles.clear();&#10;        this.documents.clear();&#10;        notifyDataSetChanged();&#10;    }&#10;    public void setDocuments(List&lt;MediaFile&gt; documents) {&#10;        this.documents = documents;&#10;        this.articles.clear();&#10;        this.videos.clear();&#10;        notifyDataSetChanged();&#10;    }&#10;    @Override&#10;    public int getItemViewType(int position) {&#10;        // Priority: articles, videos, documents&#10;        if (!articles.isEmpty()) return TYPE_ARTICLE;&#10;        if (!videos.isEmpty()) return TYPE_VIDEO;&#10;        return TYPE_DOCUMENT;&#10;    }&#10;    @NonNull&#10;    @Override&#10;    public RecyclerView.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#10;        if (viewType == TYPE_ARTICLE) {&#10;            View view = LayoutInflater.from(parent.getContext())&#10;                    .inflate(R.layout.item_library_article, parent, false);&#10;            return new ArticleViewHolder(view);&#10;        } else if (viewType == TYPE_VIDEO) {&#10;            View view = LayoutInflater.from(parent.getContext())&#10;                    .inflate(R.layout.item_library_video, parent, false);&#10;            return new VideoViewHolder(view);&#10;        } else {&#10;            // use same layout as video for documents (thumbnail + title)&#10;            View view = LayoutInflater.from(parent.getContext())&#10;                    .inflate(R.layout.item_library_video, parent, false);&#10;            return new DocumentViewHolder(view);&#10;        }&#10;    }&#10;    @Override&#10;    public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int position) {&#10;        if (getItemViewType(position) == TYPE_ARTICLE) {&#10;            ((ArticleViewHolder) holder).bind(articles.get(position));&#10;        } else if (getItemViewType(position) == TYPE_VIDEO) {&#10;            ((VideoViewHolder) holder).bind(videos.get(position));&#10;        } else {&#10;            ((DocumentViewHolder) holder).bind(documents.get(position));&#10;        }&#10;    }&#10;    @Override&#10;    public int getItemCount() {&#10;        if (!articles.isEmpty()) return articles.size();&#10;        if (!videos.isEmpty()) return videos.size();&#10;        return documents.size();&#10;    }&#10;    class ArticleViewHolder extends RecyclerView.ViewHolder {&#10;        private final ImageView imageArticle;&#10;        private final TextView textTitle;&#10;        private final TextView textDescription;&#10;        private final TextView textViews;&#10;        private final TextView textLikes;&#10;        private final TextView textReadTime;&#10;        private final TextView textCategory;&#10;&#10;        public ArticleViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            imageArticle = itemView.findViewById(R.id.imageArticle);&#10;            textTitle = itemView.findViewById(R.id.textTitle);&#10;            textDescription = itemView.findViewById(R.id.textDescription);&#10;            textViews = itemView.findViewById(R.id.textViews);&#10;            textLikes = itemView.findViewById(R.id.textLikes);&#10;            textReadTime = itemView.findViewById(R.id.textReadTime);&#10;            textCategory = itemView.findViewById(R.id.textCategory);&#10;&#10;            itemView.setOnClickListener(v -&gt; {&#10;                int position = getAdapterPosition();&#10;                if (position != RecyclerView.NO_POSITION &amp;&amp; articleListener != null) {&#10;                    articleListener.onArticleClick(articles.get(position));&#10;                }&#10;            });&#10;        }&#10;&#10;        public void bind(Article article) {&#10;            textTitle.setText(article.getTitle());&#10;            textDescription.setText(article.getDescription());&#10;            textViews.setText(String.format(&quot;%d views&quot;, article.getViews()));&#10;            textLikes.setText(String.format(&quot;%d likes&quot;, article.getLikes()));&#10;            textReadTime.setText(String.format(&quot;%d min read&quot;, article.getReadTime()));&#10;&#10;            if (article.getCategory() != null) {&#10;                textCategory.setText(article.getCategory().getTitle());&#10;                textCategory.setVisibility(View.VISIBLE);&#10;            } else {&#10;                textCategory.setVisibility(View.GONE);&#10;            }&#10;&#10;            if (article.getImageUrl() != null &amp;&amp; !article.getImageUrl().isEmpty()) {&#10;                Glide.with(itemView.getContext())&#10;                        .load(article.getImageUrl())&#10;                        .centerCrop()&#10;                        .into(imageArticle);&#10;            }&#10;        }&#10;    }&#10;    class VideoViewHolder extends RecyclerView.ViewHolder {&#10;        private final ImageView imageVideoThumb;&#10;        private final TextView textVideoTitle;&#10;&#10;        public VideoViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            imageVideoThumb = itemView.findViewById(R.id.imageVideoThumb);&#10;            textVideoTitle = itemView.findViewById(R.id.textVideoTitle);&#10;            itemView.setOnClickListener(v -&gt; {&#10;                int position = getAdapterPosition();&#10;                if (position != RecyclerView.NO_POSITION &amp;&amp; videoListener != null) {&#10;                    videoListener.onVideoClick(videos.get(position));&#10;                }&#10;            });&#10;        }&#10;&#10;        public void bind(MediaFile video) {&#10;            textVideoTitle.setText(video.getFileName());&#10;            Glide.with(itemView.getContext())&#10;                    .load(video.getFileUrl())&#10;                    .centerCrop()&#10;                    .into(imageVideoThumb);&#10;        }&#10;    }&#10;    class DocumentViewHolder extends RecyclerView.ViewHolder {&#10;        private final ImageView imageDocThumb;&#10;        private final TextView textDocTitle;&#10;&#10;        public DocumentViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            imageDocThumb = itemView.findViewById(R.id.imageVideoThumb);&#10;            textDocTitle = itemView.findViewById(R.id.textVideoTitle);&#10;            itemView.setOnClickListener(v -&gt; {&#10;                int position = getAdapterPosition();&#10;                if (position != RecyclerView.NO_POSITION &amp;&amp; documentListener != null) {&#10;                    documentListener.onDocumentClick(documents.get(position));&#10;                }&#10;            });&#10;        }&#10;&#10;        public void bind(MediaFile document) {&#10;            textDocTitle.setText(document.getFileName());&#10;            // Try to load fileUrl as thumbnail if available, otherwise show a generic icon&#10;            if (document.getFileUrl() != null &amp;&amp; !document.getFileUrl().isEmpty()) {&#10;                Glide.with(itemView.getContext())&#10;                        .load(document.getFileUrl())&#10;                        .centerCrop()&#10;                        .into(imageDocThumb);&#10;            } else {&#10;                imageDocThumb.setImageResource(R.drawable.ic_file); // fallback icon&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Check if an article already exists in the adapter.&#10;     * @param article The article to check.&#10;     * @return True if the article exists, false otherwise.&#10;     */&#10;    public boolean containsArticle(Article article) {&#10;        if (article == null || article.getId() == null) return false;&#10;        for (Article a : articles) {&#10;            if (article.getId().equals(a.getId())) {&#10;                return true;&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.notby.ui.library;&#10;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.ImageView;&#10;import android.widget.TextView;&#10;&#10;import androidx.annotation.NonNull;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.bumptech.glide.Glide;&#10;import com.example.notby.R;&#10;import com.example.notby.data.model.Article;&#10;import com.example.notby.data.model.MediaFile;&#10;import com.example.notby.data.model.User;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class LibraryAdapter extends RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt; {&#10;    private static final int TYPE_ARTICLE = 0;&#10;    private static final int TYPE_VIDEO = 1;&#10;    private static final int TYPE_DOCUMENT = 2;&#10;    private static final int TYPE_EXPERT = 3;&#10;    private List&lt;Article&gt; articles = new ArrayList&lt;&gt;();&#10;    private List&lt;MediaFile&gt; videos = new ArrayList&lt;&gt;();&#10;    private List&lt;MediaFile&gt; documents = new ArrayList&lt;&gt;();&#10;    private List&lt;User&gt; experts = new ArrayList&lt;&gt;();&#10;    private OnArticleClickListener articleListener;&#10;    private OnVideoClickListener videoListener;&#10;    private OnDocumentClickListener documentListener;&#10;    private OnExpertClickListener expertListener;&#10;&#10;    public interface OnArticleClickListener {&#10;        void onArticleClick(Article article);&#10;    }&#10;    public interface OnVideoClickListener {&#10;        void onVideoClick(MediaFile video);&#10;    }&#10;    public interface OnDocumentClickListener {&#10;        void onDocumentClick(MediaFile document);&#10;    }&#10;    public interface OnExpertClickListener {&#10;        void onExpertClick(User expert);&#10;    }&#10;    public void setOnArticleClickListener(OnArticleClickListener listener) {&#10;        this.articleListener = listener;&#10;    }&#10;    public void setOnVideoClickListener(OnVideoClickListener listener) {&#10;        this.videoListener = listener;&#10;    }&#10;    public void setOnDocumentClickListener(OnDocumentClickListener listener) {&#10;        this.documentListener = listener;&#10;    }&#10;    public void setOnExpertClickListener(OnExpertClickListener listener) {&#10;        this.expertListener = listener;&#10;    }&#10;    public void setArticles(List&lt;Article&gt; articles) {&#10;        this.articles = articles;&#10;        this.videos.clear();&#10;        this.documents.clear();&#10;        this.experts.clear();&#10;        notifyDataSetChanged();&#10;    }&#10;&#10;    // Insert a newly created article at the front of the list and notify adapter.&#10;    public void addArticleAtFront(Article article) {&#10;        if (article == null) return;&#10;        if (articles == null) articles = new ArrayList&lt;&gt;();&#10;        articles.add(0, article);&#10;        // ensure other lists are cleared because this adapter shows one type at a time&#10;        this.videos.clear();&#10;        this.documents.clear();&#10;        this.experts.clear();&#10;        // Dataset type changed (was maybe video/document), safer to refresh whole adapter&#10;        notifyDataSetChanged();&#10;    }&#10;    public void setVideos(List&lt;MediaFile&gt; videos) {&#10;        this.videos = videos;&#10;        this.articles.clear();&#10;        this.documents.clear();&#10;        this.experts.clear();&#10;        notifyDataSetChanged();&#10;    }&#10;    public void setDocuments(List&lt;MediaFile&gt; documents) {&#10;        this.documents = documents;&#10;        this.articles.clear();&#10;        this.videos.clear();&#10;        this.experts.clear();&#10;        notifyDataSetChanged();&#10;    }&#10;&#10;    public void setExperts(List&lt;User&gt; experts) {&#10;        this.experts = experts;&#10;        this.articles.clear();&#10;        this.videos.clear();&#10;        this.documents.clear();&#10;        notifyDataSetChanged();&#10;    }&#10;    @Override&#10;    public int getItemViewType(int position) {&#10;        // Priority: articles, videos, documents, experts&#10;        if (!articles.isEmpty()) return TYPE_ARTICLE;&#10;        if (!videos.isEmpty()) return TYPE_VIDEO;&#10;        if (!documents.isEmpty()) return TYPE_DOCUMENT;&#10;        return TYPE_EXPERT;&#10;    }&#10;    @NonNull&#10;    @Override&#10;    public RecyclerView.ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {&#10;        if (viewType == TYPE_ARTICLE) {&#10;            View view = LayoutInflater.from(parent.getContext())&#10;                    .inflate(R.layout.item_library_article, parent, false);&#10;            return new ArticleViewHolder(view);&#10;        } else if (viewType == TYPE_VIDEO) {&#10;            View view = LayoutInflater.from(parent.getContext())&#10;                    .inflate(R.layout.item_library_video, parent, false);&#10;            return new VideoViewHolder(view);&#10;        } else if (viewType == TYPE_EXPERT) {&#10;            View view = LayoutInflater.from(parent.getContext())&#10;                    .inflate(R.layout.item_library_expert, parent, false);&#10;            return new ExpertViewHolder(view);&#10;        } else {&#10;            // use same layout as video for documents (thumbnail + title)&#10;            View view = LayoutInflater.from(parent.getContext())&#10;                    .inflate(R.layout.item_library_video, parent, false);&#10;            return new DocumentViewHolder(view);&#10;        }&#10;    }&#10;    @Override&#10;    public void onBindViewHolder(@NonNull RecyclerView.ViewHolder holder, int position) {&#10;        if (getItemViewType(position) == TYPE_ARTICLE) {&#10;            ((ArticleViewHolder) holder).bind(articles.get(position));&#10;        } else if (getItemViewType(position) == TYPE_VIDEO) {&#10;            ((VideoViewHolder) holder).bind(videos.get(position));&#10;        } else if (getItemViewType(position) == TYPE_EXPERT) {&#10;            ((ExpertViewHolder) holder).bind(experts.get(position));&#10;        } else {&#10;            ((DocumentViewHolder) holder).bind(documents.get(position));&#10;        }&#10;    }&#10;    @Override&#10;    public int getItemCount() {&#10;        if (!articles.isEmpty()) return articles.size();&#10;        if (!videos.isEmpty()) return videos.size();&#10;        if (!documents.isEmpty()) return documents.size();&#10;        return experts.size();&#10;    }&#10;    class ArticleViewHolder extends RecyclerView.ViewHolder {&#10;        private final ImageView imageArticle;&#10;        private final TextView textTitle;&#10;        private final TextView textDescription;&#10;        private final TextView textViews;&#10;        private final TextView textLikes;&#10;        private final TextView textReadTime;&#10;        private final TextView textCategory;&#10;&#10;        public ArticleViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            imageArticle = itemView.findViewById(R.id.imageArticle);&#10;            textTitle = itemView.findViewById(R.id.textTitle);&#10;            textDescription = itemView.findViewById(R.id.textDescription);&#10;            textViews = itemView.findViewById(R.id.textViews);&#10;            textLikes = itemView.findViewById(R.id.textLikes);&#10;            textReadTime = itemView.findViewById(R.id.textReadTime);&#10;            textCategory = itemView.findViewById(R.id.textCategory);&#10;&#10;            itemView.setOnClickListener(v -&gt; {&#10;                int position = getAdapterPosition();&#10;                if (position != RecyclerView.NO_POSITION &amp;&amp; articleListener != null) {&#10;                    articleListener.onArticleClick(articles.get(position));&#10;                }&#10;            });&#10;        }&#10;&#10;        public void bind(Article article) {&#10;            textTitle.setText(article.getTitle());&#10;            textDescription.setText(article.getDescription());&#10;            textViews.setText(String.format(&quot;%d views&quot;, article.getViews()));&#10;            textLikes.setText(String.format(&quot;%d likes&quot;, article.getLikes()));&#10;            textReadTime.setText(String.format(&quot;%d min read&quot;, article.getReadTime()));&#10;&#10;            if (article.getCategory() != null) {&#10;                textCategory.setText(article.getCategory().getTitle());&#10;                textCategory.setVisibility(View.VISIBLE);&#10;            } else {&#10;                textCategory.setVisibility(View.GONE);&#10;            }&#10;&#10;            if (article.getImageUrl() != null &amp;&amp; !article.getImageUrl().isEmpty()) {&#10;                Glide.with(itemView.getContext())&#10;                        .load(article.getImageUrl())&#10;                        .centerCrop()&#10;                        .into(imageArticle);&#10;            }&#10;        }&#10;    }&#10;    class VideoViewHolder extends RecyclerView.ViewHolder {&#10;        private final ImageView imageVideoThumb;&#10;        private final TextView textVideoTitle;&#10;&#10;        public VideoViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            imageVideoThumb = itemView.findViewById(R.id.imageVideoThumb);&#10;            textVideoTitle = itemView.findViewById(R.id.textVideoTitle);&#10;            itemView.setOnClickListener(v -&gt; {&#10;                int position = getAdapterPosition();&#10;                if (position != RecyclerView.NO_POSITION &amp;&amp; videoListener != null) {&#10;                    videoListener.onVideoClick(videos.get(position));&#10;                }&#10;            });&#10;        }&#10;&#10;        public void bind(MediaFile video) {&#10;            textVideoTitle.setText(video.getFileName());&#10;            Glide.with(itemView.getContext())&#10;                    .load(video.getFileUrl())&#10;                    .centerCrop()&#10;                    .into(imageVideoThumb);&#10;        }&#10;    }&#10;    class DocumentViewHolder extends RecyclerView.ViewHolder {&#10;        private final ImageView imageDocThumb;&#10;        private final TextView textDocTitle;&#10;&#10;        public DocumentViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            imageDocThumb = itemView.findViewById(R.id.imageVideoThumb);&#10;            textDocTitle = itemView.findViewById(R.id.textVideoTitle);&#10;            itemView.setOnClickListener(v -&gt; {&#10;                int position = getAdapterPosition();&#10;                if (position != RecyclerView.NO_POSITION &amp;&amp; documentListener != null) {&#10;                    documentListener.onDocumentClick(documents.get(position));&#10;                }&#10;            });&#10;        }&#10;&#10;        public void bind(MediaFile document) {&#10;            textDocTitle.setText(document.getFileName());&#10;            // Try to load fileUrl as thumbnail if available, otherwise show a generic icon&#10;            if (document.getFileUrl() != null &amp;&amp; !document.getFileUrl().isEmpty()) {&#10;                Glide.with(itemView.getContext())&#10;                        .load(document.getFileUrl())&#10;                        .centerCrop()&#10;                        .into(imageDocThumb);&#10;            } else {&#10;                imageDocThumb.setImageResource(R.drawable.ic_file); // fallback icon&#10;            }&#10;        }&#10;    }&#10;&#10;    class ExpertViewHolder extends RecyclerView.ViewHolder {&#10;        private final ImageView imageExpert;&#10;        private final TextView textExpertName;&#10;        private final TextView textExpertRole;&#10;        private final TextView textExpertEmail;&#10;&#10;        public ExpertViewHolder(@NonNull View itemView) {&#10;            super(itemView);&#10;            imageExpert = itemView.findViewById(R.id.imageExpert);&#10;            textExpertName = itemView.findViewById(R.id.textExpertName);&#10;            textExpertRole = itemView.findViewById(R.id.textExpertRole);&#10;            textExpertEmail = itemView.findViewById(R.id.textExpertEmail);&#10;            &#10;            itemView.setOnClickListener(v -&gt; {&#10;                int position = getAdapterPosition();&#10;                if (position != RecyclerView.NO_POSITION &amp;&amp; expertListener != null) {&#10;                    expertListener.onExpertClick(experts.get(position));&#10;                }&#10;            });&#10;        }&#10;&#10;        public void bind(User expert) {&#10;            textExpertName.setText(expert.getUsername());&#10;            textExpertRole.setText(expert.getRole());&#10;            textExpertEmail.setText(expert.getEmail());&#10;            &#10;            // Load expert photo if available&#10;            if (expert.getPhoto() != null &amp;&amp; !expert.getPhoto().isEmpty()) {&#10;                Glide.with(itemView.getContext())&#10;                        .load(expert.getPhoto())&#10;                        .centerCrop()&#10;                        .placeholder(R.drawable.ic_person)&#10;                        .into(imageExpert);&#10;            } else {&#10;                imageExpert.setImageResource(R.drawable.ic_person);&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Check if an article already exists in the adapter.&#10;     * @param article The article to check.&#10;     * @return True if the article exists, false otherwise.&#10;     */&#10;    public boolean containsArticle(Article article) {&#10;        if (article == null || article.getId() == null) return false;&#10;        for (Article a : articles) {&#10;            if (article.getId().equals(a.getId())) {&#10;                return true;&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/notby/ui/library/LibraryContentFragment.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/notby/ui/library/LibraryContentFragment.java" />
              <option name="originalContent" value="package com.example.notby.ui.library;&#10;&#10;import android.app.Activity;&#10;import android.app.DownloadManager;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.net.Uri;&#10;import android.os.Bundle;&#10;import android.os.Environment;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import androidx.activity.result.ActivityResultLauncher;&#10;import androidx.activity.result.contract.ActivityResultContracts;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.appcompat.app.AlertDialog;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.GridLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.notby.R;&#10;import com.example.notby.data.model.ApiResponse;&#10;import com.example.notby.data.model.Article;&#10;import com.example.notby.data.model.MediaFile;&#10;import com.example.notby.data.remote.ApiClient;&#10;import com.google.android.material.floatingactionbutton.FloatingActionButton;&#10;&#10;import java.util.List;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class LibraryContentFragment extends Fragment {&#10;    private static final String ARG_POSITION = &quot;position&quot;;&#10;    private int position;&#10;    private RecyclerView recyclerView;&#10;    private LibraryAdapter adapter;&#10;    private boolean pendingReload = false;&#10;    private java.util.List&lt;com.example.notby.data.model.Article&gt; pendingAddedArticles = new java.util.ArrayList&lt;&gt;();&#10;    // Buffer of locally created articles to merge with server results to avoid overwriting them&#10;    private java.util.List&lt;com.example.notby.data.model.Article&gt; createdArticlesBuffer = new java.util.ArrayList&lt;&gt;();&#10;&#10;    // Video upload functionality&#10;    private VideoUploadManager videoUploadManager;&#10;    private ActivityResultLauncher&lt;Intent&gt; videoPickerLauncher;&#10;    private Uri selectedVideoUri;&#10;    private String selectedVideoName;&#10;&#10;    public static LibraryContentFragment newInstance(int position) {&#10;        LibraryContentFragment fragment = new LibraryContentFragment();&#10;        Bundle args = new Bundle();&#10;        args.putInt(ARG_POSITION, position);&#10;        fragment.setArguments(args);&#10;        return fragment;&#10;    }&#10;&#10;    @Override&#10;    public void onCreate(@Nullable Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        if (getArguments() != null) {&#10;            position = getArguments().getInt(ARG_POSITION);&#10;        }&#10;&#10;        // Initialize video upload functionality&#10;        videoUploadManager = new VideoUploadManager(requireContext());&#10;        videoPickerLauncher = registerForActivityResult(&#10;            new ActivityResultContracts.StartActivityForResult(),&#10;            result -&gt; {&#10;                if (result.getResultCode() == Activity.RESULT_OK &amp;&amp; result.getData() != null) {&#10;                    Uri uri = result.getData().getData();&#10;                    if (uri != null) {&#10;                        selectedVideoUri = uri;&#10;                        selectedVideoName = getFileName(uri);&#10;                        // Notify that video was selected&#10;                        Bundle resultBundle = new Bundle();&#10;                        resultBundle.putBoolean(&quot;selected&quot;, true);&#10;                        getParentFragmentManager().setFragmentResult(&quot;video_selected&quot;, resultBundle);&#10;                    }&#10;                }&#10;            }&#10;        );&#10;&#10;        // Ensure the listener is set only once&#10;        getParentFragmentManager().setFragmentResultListener(&quot;article_created&quot;, this, (requestKey, bundle) -&gt; {&#10;            boolean refresh = bundle.getBoolean(&quot;refresh&quot;, false);&#10;            if (refresh &amp;&amp; position == 0) {&#10;                // If created article JSON exists, try to deserialize and add it immediately&#10;                String createdJson = bundle.getString(&quot;created_article_json&quot;, null);&#10;                if (createdJson != null) {&#10;                    try {&#10;                        com.google.gson.Gson gson = new com.google.gson.Gson();&#10;                        com.example.notby.data.model.Article created = gson.fromJson(createdJson, com.example.notby.data.model.Article.class);&#10;                        if (created != null) addArticle(created);&#10;                    } catch (Exception e) {&#10;                        // ignore JSON parsing issues and fallback to full reload&#10;                        reloadArticles();&#10;                    }&#10;                } else {&#10;                    reloadArticles();&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_library_content, container, false);&#10;        recyclerView = view.findViewById(R.id.recyclerView);&#10;        FloatingActionButton fabUploadVideo = view.findViewById(R.id.fabUploadVideo);&#10;&#10;        setupRecyclerView();&#10;        adapter.setOnVideoClickListener(video -&gt; openVideo(video));&#10;        adapter.setOnDocumentClickListener(document -&gt; downloadDocument(document));&#10;&#10;        // Setup FAB for video upload (only show in video tab)&#10;        if (position == 1) {&#10;            fabUploadVideo.setVisibility(View.VISIBLE);&#10;            fabUploadVideo.setOnClickListener(v -&gt; showVideoUploadDialog());&#10;        } else {&#10;            fabUploadVideo.setVisibility(View.GONE);&#10;        }&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void onResume() {&#10;        super.onResume();&#10;        loadContent();&#10;    }&#10;&#10;    private void setupRecyclerView() {&#10;        adapter = new LibraryAdapter();&#10;        recyclerView.setLayoutManager(new GridLayoutManager(getContext(), 2));&#10;        recyclerView.setAdapter(adapter);&#10;        // If a reload request arrived before the view was created, perform it now&#10;        if (pendingReload) {&#10;            pendingReload = false;&#10;            loadArticles();&#10;        }&#10;        // If any articles were added before adapter initialization, insert them now&#10;        if (!pendingAddedArticles.isEmpty()) {&#10;            for (int i = pendingAddedArticles.size() - 1; i &gt;= 0; i--) {&#10;                com.example.notby.data.model.Article a = pendingAddedArticles.get(i);&#10;                adapter.addArticleAtFront(a);&#10;                createdArticlesBuffer.add(0, a);&#10;            }&#10;            pendingAddedArticles.clear();&#10;        }&#10;    }&#10;&#10;    private void loadContent() {&#10;        switch (position) {&#10;            case 0: // Articles&#10;                adapter.setOnArticleClickListener(null); // Only enable article click for articles&#10;                loadArticles();&#10;                break;&#10;            case 1: // Videos&#10;                adapter.setOnArticleClickListener(null);&#10;                loadVideos();&#10;                break;&#10;            case 2: // Experts&#10;                // TODO: Implement experts loading&#10;                break;&#10;            case 3: // Documents&#10;                adapter.setOnArticleClickListener(null);&#10;                loadDocuments();&#10;                break;&#10;        }&#10;    }&#10;&#10;    private void loadArticles() {&#10;        ApiClient.getArticleApi().getAllArticles().enqueue(new Callback&lt;ApiResponse&lt;List&lt;Article&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;Article&gt;&gt;&gt; call, Response&lt;ApiResponse&lt;List&lt;Article&gt;&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    java.util.List&lt;Article&gt; serverList = response.body().getData();&#10;                    if (serverList == null) serverList = new java.util.ArrayList&lt;&gt;();&#10;                    // Merge local created articles on top if not already present&#10;                    if (!createdArticlesBuffer.isEmpty()) {&#10;                        for (int i = createdArticlesBuffer.size() - 1; i &gt;= 0; i--) {&#10;                            Article created = createdArticlesBuffer.get(i);&#10;                            boolean exists = false;&#10;                            if (created.getId() != null) {&#10;                                for (Article s : serverList) {&#10;                                    if (created.getId().equals(s.getId())) { exists = true; break; }&#10;                                }&#10;                            }&#10;                            if (!exists) serverList.add(0, created);&#10;                        }&#10;                        // Clear the buffer after merging&#10;                        createdArticlesBuffer.clear();&#10;                    }&#10;                    adapter.setArticles(serverList);&#10;                } else {&#10;                    Toast.makeText(getContext(), &quot;Lỗi khi tải bài viết&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;Article&gt;&gt;&gt; call, Throwable t) {&#10;                Toast.makeText(getContext(), &quot;Lỗi kết nối: &quot; + t.getMessage(), Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadVideos() {&#10;        ApiClient.getMediafileApi().findByFileType(&quot;video&quot;).enqueue(new Callback&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; call, Response&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    adapter.setVideos(response.body().getData());&#10;                } else {&#10;                    Toast.makeText(getContext(), &quot;Lỗi khi tải video&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; call, Throwable t) {&#10;                Toast.makeText(getContext(), &quot;Lỗi kết nối: &quot; + t.getMessage(), Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadDocuments() {&#10;        ApiClient.getMediafileApi().findByFileType(&quot;other&quot;).enqueue(new Callback&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; call, Response&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    adapter.setDocuments(response.body().getData());&#10;                } else {&#10;                    Toast.makeText(getContext(), &quot;Lỗi khi tải tài liệu&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; call, Throwable t) {&#10;                Toast.makeText(getContext(), &quot;Lỗi kết nối: &quot; + t.getMessage(), Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void openVideo(MediaFile video) {&#10;        Intent intent = new Intent(Intent.ACTION_VIEW);&#10;        intent.setDataAndType(Uri.parse(video.getFileUrl()), &quot;video/*&quot;);&#10;        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);&#10;        startActivity(intent);&#10;    }&#10;&#10;    private void downloadDocument(MediaFile document) {&#10;        if (document == null || document.getFileUrl() == null) {&#10;            Toast.makeText(getContext(), &quot;Tệp không hợp lệ&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        String url = document.getFileUrl();&#10;        // Try to open in external app/browser first&#10;        try {&#10;            Intent intent = new Intent(Intent.ACTION_VIEW);&#10;            intent.setData(Uri.parse(url));&#10;            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);&#10;            startActivity(intent);&#10;        } catch (Exception e) {&#10;            // Fallback to DownloadManager to save the file&#10;            try {&#10;                DownloadManager.Request request = new DownloadManager.Request(Uri.parse(url));&#10;                request.setTitle(document.getFileName());&#10;                request.setDescription(&quot;Downloading document...&quot;);&#10;                request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED);&#10;                request.setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, document.getFileName());&#10;&#10;                Context ctx = getContext();&#10;                if (ctx != null) {&#10;                    DownloadManager dm = (DownloadManager) ctx.getSystemService(Context.DOWNLOAD_SERVICE);&#10;                    if (dm != null) dm.enqueue(request);&#10;                }&#10;                Toast.makeText(getContext(), &quot;Đã bắt đầu tải xuống&quot;, Toast.LENGTH_SHORT).show();&#10;            } catch (Exception ex) {&#10;                Toast.makeText(getContext(), &quot;Không thể tải xuống tệp: &quot; + ex.getMessage(), Toast.LENGTH_SHORT).show();&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Public method to allow the activity to request articles reload.&#10;     * Only reloads when this fragment represents the Articles tab (position == 0).&#10;     */&#10;    public void reloadArticles() {&#10;        if (position != 0) return;&#10;        // If adapter or view not ready, set pending flag so it reloads in onCreateView/setupRecyclerView&#10;        if (adapter == null || getView() == null) {&#10;            pendingReload = true;&#10;            return;&#10;        }&#10;        loadArticles();&#10;    }&#10;&#10;    /**&#10;     * Add a newly created article to the top of the list. If adapter isn't ready, queue it.&#10;     */&#10;    public void addArticle(com.example.notby.data.model.Article article) {&#10;        if (article == null || position != 0) return;&#10;        if (adapter == null || getView() == null) {&#10;            pendingAddedArticles.add(article);&#10;            return;&#10;        }&#10;        // ensure we run on UI thread&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                android.util.Log.d(&quot;LibraryContentFragment&quot;, &quot;Adding article id=&quot; + (article.getId() != null ? article.getId() : &quot;&lt;no-id&gt;&quot;));&#10;                // Check if the article already exists in the adapter&#10;                if (adapter != null &amp;&amp; !adapter.containsArticle(article)) {&#10;                    adapter.addArticleAtFront(article);&#10;                    createdArticlesBuffer.add(0, article);&#10;                }&#10;                if (recyclerView != null) recyclerView.scrollToPosition(0);&#10;            });&#10;        } else {&#10;            android.util.Log.d(&quot;LibraryContentFragment&quot;, &quot;Adding article (no activity) id=&quot; + (article.getId() != null ? article.getId() : &quot;&lt;no-id&gt;&quot;));&#10;        }&#10;    }&#10;&#10;    private void showVideoUploadDialog() {&#10;        View dialogView = LayoutInflater.from(getContext()).inflate(R.layout.dialog_upload_video, null);&#10;&#10;        AlertDialog dialog = new AlertDialog.Builder(requireContext())&#10;            .setView(dialogView)&#10;            .setCancelable(false)&#10;            .create();&#10;&#10;        // Get dialog controls&#10;        android.widget.Button btnSelectVideo = dialogView.findViewById(R.id.btnSelectVideo);&#10;        android.widget.TextView tvSelectedFile = dialogView.findViewById(R.id.tvSelectedFile);&#10;        android.widget.ProgressBar progressBar = dialogView.findViewById(R.id.progressBar);&#10;        android.widget.TextView tvProgress = dialogView.findViewById(R.id.tvProgress);&#10;        android.widget.Button btnCancel = dialogView.findViewById(R.id.btnCancel);&#10;        android.widget.Button btnUpload = dialogView.findViewById(R.id.btnUpload);&#10;&#10;        // Reset state&#10;        selectedVideoUri = null;&#10;        selectedVideoName = null;&#10;&#10;        btnSelectVideo.setOnClickListener(v -&gt; {&#10;            Intent intent = new Intent(Intent.ACTION_GET_CONTENT);&#10;            intent.setType(&quot;video/*&quot;);&#10;            intent.addCategory(Intent.CATEGORY_OPENABLE);&#10;            videoPickerLauncher.launch(Intent.createChooser(intent, &quot;Chọn video&quot;));&#10;        });&#10;&#10;        btnCancel.setOnClickListener(v -&gt; dialog.dismiss());&#10;&#10;        btnUpload.setOnClickListener(v -&gt; {&#10;            if (selectedVideoUri != null &amp;&amp; selectedVideoName != null) {&#10;                btnUpload.setEnabled(false);&#10;                btnSelectVideo.setEnabled(false);&#10;                progressBar.setVisibility(View.VISIBLE);&#10;                tvProgress.setVisibility(View.VISIBLE);&#10;&#10;                videoUploadManager.uploadVideo(selectedVideoUri, selectedVideoName, new VideoUploadManager.VideoUploadCallback() {&#10;                    @Override&#10;                    public void onUploadStart() {&#10;                        requireActivity().runOnUiThread(() -&gt; {&#10;                            tvProgress.setText(&quot;Bắt đầu tải lên...&quot;);&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onUploadProgress(String message) {&#10;                        requireActivity().runOnUiThread(() -&gt; {&#10;                            tvProgress.setText(message);&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onUploadSuccess(MediaFile mediaFile) {&#10;                        requireActivity().runOnUiThread(() -&gt; {&#10;                            dialog.dismiss();&#10;                            Toast.makeText(getContext(), &quot;Tải lên video thành công!&quot;, Toast.LENGTH_SHORT).show();&#10;                            // Refresh the videos list&#10;                            loadVideos();&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onUploadError(String error) {&#10;                        requireActivity().runOnUiThread(() -&gt; {&#10;                            btnUpload.setEnabled(true);&#10;                            btnSelectVideo.setEnabled(true);&#10;                            progressBar.setVisibility(View.GONE);&#10;                            tvProgress.setVisibility(View.GONE);&#10;                            Toast.makeText(getContext(), &quot;Lỗi: &quot; + error, Toast.LENGTH_LONG).show();&#10;                        });&#10;                    }&#10;                });&#10;            }&#10;        });&#10;&#10;        // Listen for video selection result&#10;        getParentFragmentManager().setFragmentResultListener(&quot;video_selected&quot;, this, (requestKey, bundle) -&gt; {&#10;            if (selectedVideoUri != null &amp;&amp; selectedVideoName != null) {&#10;                tvSelectedFile.setText(&quot;Đã chọn: &quot; + selectedVideoName);&#10;                tvSelectedFile.setVisibility(View.VISIBLE);&#10;                btnUpload.setEnabled(true);&#10;            }&#10;        });&#10;&#10;        dialog.show();&#10;&#10;        // Trigger result listener when video is selected&#10;        if (selectedVideoUri != null &amp;&amp; selectedVideoName != null) {&#10;            tvSelectedFile.setText(&quot;Đã chọn: &quot; + selectedVideoName);&#10;            tvSelectedFile.setVisibility(View.VISIBLE);&#10;            btnUpload.setEnabled(true);&#10;        }&#10;    }&#10;&#10;    private String getFileName(Uri uri) {&#10;        String result = null;&#10;        if (uri.getScheme().equals(&quot;content&quot;)) {&#10;            try (android.database.Cursor cursor = requireContext().getContentResolver().query(uri, null, null, null, null)) {&#10;                if (cursor != null &amp;&amp; cursor.moveToFirst()) {&#10;                    int nameIndex = cursor.getColumnIndex(android.provider.OpenableColumns.DISPLAY_NAME);&#10;                    if (nameIndex &gt;= 0) {&#10;                        result = cursor.getString(nameIndex);&#10;                    }&#10;                }&#10;            } catch (Exception e) {&#10;                // Ignore&#10;            }&#10;        }&#10;        if (result == null) {&#10;            result = uri.getPath();&#10;            int cut = result.lastIndexOf('/');&#10;            if (cut != -1) {&#10;                result = result.substring(cut + 1);&#10;            }&#10;        }&#10;        return result != null ? result : &quot;video_&quot; + System.currentTimeMillis() + &quot;.mp4&quot;;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package com.example.notby.ui.library;&#10;&#10;import android.app.Activity;&#10;import android.app.DownloadManager;&#10;import android.content.Context;&#10;import android.content.Intent;&#10;import android.net.Uri;&#10;import android.os.Bundle;&#10;import android.os.Environment;&#10;import android.view.LayoutInflater;&#10;import android.view.View;&#10;import android.view.ViewGroup;&#10;import android.widget.Toast;&#10;&#10;import androidx.activity.result.ActivityResultLauncher;&#10;import androidx.activity.result.contract.ActivityResultContracts;&#10;import androidx.annotation.NonNull;&#10;import androidx.annotation.Nullable;&#10;import androidx.appcompat.app.AlertDialog;&#10;import androidx.fragment.app.Fragment;&#10;import androidx.recyclerview.widget.GridLayoutManager;&#10;import androidx.recyclerview.widget.RecyclerView;&#10;&#10;import com.example.notby.R;&#10;import com.example.notby.data.model.ApiResponse;&#10;import com.example.notby.data.model.Article;&#10;import com.example.notby.data.model.MediaFile;&#10;import com.example.notby.data.remote.ApiClient;&#10;import com.google.android.material.floatingactionbutton.FloatingActionButton;&#10;&#10;import java.util.List;&#10;&#10;import retrofit2.Call;&#10;import retrofit2.Callback;&#10;import retrofit2.Response;&#10;&#10;public class LibraryContentFragment extends Fragment {&#10;    private static final String ARG_POSITION = &quot;position&quot;;&#10;    private int position;&#10;    private RecyclerView recyclerView;&#10;    private LibraryAdapter adapter;&#10;    private boolean pendingReload = false;&#10;    private java.util.List&lt;com.example.notby.data.model.Article&gt; pendingAddedArticles = new java.util.ArrayList&lt;&gt;();&#10;    // Buffer of locally created articles to merge with server results to avoid overwriting them&#10;    private java.util.List&lt;com.example.notby.data.model.Article&gt; createdArticlesBuffer = new java.util.ArrayList&lt;&gt;();&#10;&#10;    // Video upload functionality&#10;    private VideoUploadManager videoUploadManager;&#10;    private ActivityResultLauncher&lt;Intent&gt; videoPickerLauncher;&#10;    private Uri selectedVideoUri;&#10;    private String selectedVideoName;&#10;&#10;    public static LibraryContentFragment newInstance(int position) {&#10;        LibraryContentFragment fragment = new LibraryContentFragment();&#10;        Bundle args = new Bundle();&#10;        args.putInt(ARG_POSITION, position);&#10;        fragment.setArguments(args);&#10;        return fragment;&#10;    }&#10;&#10;    @Override&#10;    public void onCreate(@Nullable Bundle savedInstanceState) {&#10;        super.onCreate(savedInstanceState);&#10;        if (getArguments() != null) {&#10;            position = getArguments().getInt(ARG_POSITION);&#10;        }&#10;&#10;        // Initialize video upload functionality&#10;        videoUploadManager = new VideoUploadManager(requireContext());&#10;        videoPickerLauncher = registerForActivityResult(&#10;            new ActivityResultContracts.StartActivityForResult(),&#10;            result -&gt; {&#10;                if (result.getResultCode() == Activity.RESULT_OK &amp;&amp; result.getData() != null) {&#10;                    Uri uri = result.getData().getData();&#10;                    if (uri != null) {&#10;                        selectedVideoUri = uri;&#10;                        selectedVideoName = getFileName(uri);&#10;                        // Notify that video was selected&#10;                        Bundle resultBundle = new Bundle();&#10;                        resultBundle.putBoolean(&quot;selected&quot;, true);&#10;                        getParentFragmentManager().setFragmentResult(&quot;video_selected&quot;, resultBundle);&#10;                    }&#10;                }&#10;            }&#10;        );&#10;&#10;        // Ensure the listener is set only once&#10;        getParentFragmentManager().setFragmentResultListener(&quot;article_created&quot;, this, (requestKey, bundle) -&gt; {&#10;            boolean refresh = bundle.getBoolean(&quot;refresh&quot;, false);&#10;            if (refresh &amp;&amp; position == 0) {&#10;                // If created article JSON exists, try to deserialize and add it immediately&#10;                String createdJson = bundle.getString(&quot;created_article_json&quot;, null);&#10;                if (createdJson != null) {&#10;                    try {&#10;                        com.google.gson.Gson gson = new com.google.gson.Gson();&#10;                        com.example.notby.data.model.Article created = gson.fromJson(createdJson, com.example.notby.data.model.Article.class);&#10;                        if (created != null) addArticle(created);&#10;                    } catch (Exception e) {&#10;                        // ignore JSON parsing issues and fallback to full reload&#10;                        reloadArticles();&#10;                    }&#10;                } else {&#10;                    reloadArticles();&#10;                }&#10;            }&#10;        });&#10;    }&#10;&#10;    @Nullable&#10;    @Override&#10;    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {&#10;        View view = inflater.inflate(R.layout.fragment_library_content, container, false);&#10;        recyclerView = view.findViewById(R.id.recyclerView);&#10;        FloatingActionButton fabUploadVideo = view.findViewById(R.id.fabUploadVideo);&#10;&#10;        setupRecyclerView();&#10;        adapter.setOnVideoClickListener(video -&gt; openVideo(video));&#10;        adapter.setOnDocumentClickListener(document -&gt; downloadDocument(document));&#10;        adapter.setOnExpertClickListener(expert -&gt; openExpertProfile(expert));&#10;&#10;        // Setup FAB for video upload (only show in video tab)&#10;        if (position == 1) {&#10;            fabUploadVideo.setVisibility(View.VISIBLE);&#10;            fabUploadVideo.setOnClickListener(v -&gt; showVideoUploadDialog());&#10;        } else {&#10;            fabUploadVideo.setVisibility(View.GONE);&#10;        }&#10;&#10;        return view;&#10;    }&#10;&#10;    @Override&#10;    public void onResume() {&#10;        super.onResume();&#10;        loadContent();&#10;    }&#10;&#10;    private void setupRecyclerView() {&#10;        adapter = new LibraryAdapter();&#10;        recyclerView.setLayoutManager(new GridLayoutManager(getContext(), 2));&#10;        recyclerView.setAdapter(adapter);&#10;        // If a reload request arrived before the view was created, perform it now&#10;        if (pendingReload) {&#10;            pendingReload = false;&#10;            loadArticles();&#10;        }&#10;        // If any articles were added before adapter initialization, insert them now&#10;        if (!pendingAddedArticles.isEmpty()) {&#10;            for (int i = pendingAddedArticles.size() - 1; i &gt;= 0; i--) {&#10;                com.example.notby.data.model.Article a = pendingAddedArticles.get(i);&#10;                adapter.addArticleAtFront(a);&#10;                createdArticlesBuffer.add(0, a);&#10;            }&#10;            pendingAddedArticles.clear();&#10;        }&#10;    }&#10;&#10;    private void loadContent() {&#10;        switch (position) {&#10;            case 0: // Articles&#10;                adapter.setOnArticleClickListener(null); // Only enable article click for articles&#10;                loadArticles();&#10;                break;&#10;            case 1: // Videos&#10;                adapter.setOnArticleClickListener(null);&#10;                loadVideos();&#10;                break;&#10;            case 2: // Experts&#10;                adapter.setOnArticleClickListener(null);&#10;                loadExperts();&#10;                break;&#10;            case 3: // Documents&#10;                adapter.setOnArticleClickListener(null);&#10;                loadDocuments();&#10;                break;&#10;        }&#10;    }&#10;&#10;    private void loadArticles() {&#10;        ApiClient.getArticleApi().getAllArticles().enqueue(new Callback&lt;ApiResponse&lt;List&lt;Article&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;Article&gt;&gt;&gt; call, Response&lt;ApiResponse&lt;List&lt;Article&gt;&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    java.util.List&lt;Article&gt; serverList = response.body().getData();&#10;                    if (serverList == null) serverList = new java.util.ArrayList&lt;&gt;();&#10;                    // Merge local created articles on top if not already present&#10;                    if (!createdArticlesBuffer.isEmpty()) {&#10;                        for (int i = createdArticlesBuffer.size() - 1; i &gt;= 0; i--) {&#10;                            Article created = createdArticlesBuffer.get(i);&#10;                            boolean exists = false;&#10;                            if (created.getId() != null) {&#10;                                for (Article s : serverList) {&#10;                                    if (created.getId().equals(s.getId())) { exists = true; break; }&#10;                                }&#10;                            }&#10;                            if (!exists) serverList.add(0, created);&#10;                        }&#10;                        // Clear the buffer after merging&#10;                        createdArticlesBuffer.clear();&#10;                    }&#10;                    adapter.setArticles(serverList);&#10;                } else {&#10;                    Toast.makeText(getContext(), &quot;Lỗi khi tải bài viết&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;Article&gt;&gt;&gt; call, Throwable t) {&#10;                Toast.makeText(getContext(), &quot;Lỗi kết nối: &quot; + t.getMessage(), Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadVideos() {&#10;        ApiClient.getMediafileApi().findByFileType(&quot;video&quot;).enqueue(new Callback&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; call, Response&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    adapter.setVideos(response.body().getData());&#10;                } else {&#10;                    Toast.makeText(getContext(), &quot;Lỗi khi tải video&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; call, Throwable t) {&#10;                Toast.makeText(getContext(), &quot;Lỗi kết nối: &quot; + t.getMessage(), Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void loadDocuments() {&#10;        ApiClient.getMediafileApi().findByFileType(&quot;other&quot;).enqueue(new Callback&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt;() {&#10;            @Override&#10;            public void onResponse(Call&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; call, Response&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; response) {&#10;                if (response.isSuccessful() &amp;&amp; response.body() != null) {&#10;                    adapter.setDocuments(response.body().getData());&#10;                } else {&#10;                    Toast.makeText(getContext(), &quot;Lỗi khi tải tài liệu&quot;, Toast.LENGTH_SHORT).show();&#10;                }&#10;            }&#10;&#10;            @Override&#10;            public void onFailure(Call&lt;ApiResponse&lt;List&lt;MediaFile&gt;&gt;&gt; call, Throwable t) {&#10;                Toast.makeText(getContext(), &quot;Lỗi kết nối: &quot; + t.getMessage(), Toast.LENGTH_SHORT).show();&#10;            }&#10;        });&#10;    }&#10;&#10;    private void openVideo(MediaFile video) {&#10;        Intent intent = new Intent(Intent.ACTION_VIEW);&#10;        intent.setDataAndType(Uri.parse(video.getFileUrl()), &quot;video/*&quot;);&#10;        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);&#10;        startActivity(intent);&#10;    }&#10;&#10;    private void downloadDocument(MediaFile document) {&#10;        if (document == null || document.getFileUrl() == null) {&#10;            Toast.makeText(getContext(), &quot;Tệp không hợp lệ&quot;, Toast.LENGTH_SHORT).show();&#10;            return;&#10;        }&#10;&#10;        String url = document.getFileUrl();&#10;        // Try to open in external app/browser first&#10;        try {&#10;            Intent intent = new Intent(Intent.ACTION_VIEW);&#10;            intent.setData(Uri.parse(url));&#10;            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);&#10;            startActivity(intent);&#10;        } catch (Exception e) {&#10;            // Fallback to DownloadManager to save the file&#10;            try {&#10;                DownloadManager.Request request = new DownloadManager.Request(Uri.parse(url));&#10;                request.setTitle(document.getFileName());&#10;                request.setDescription(&quot;Downloading document...&quot;);&#10;                request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED);&#10;                request.setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, document.getFileName());&#10;&#10;                Context ctx = getContext();&#10;                if (ctx != null) {&#10;                    DownloadManager dm = (DownloadManager) ctx.getSystemService(Context.DOWNLOAD_SERVICE);&#10;                    if (dm != null) dm.enqueue(request);&#10;                }&#10;                Toast.makeText(getContext(), &quot;Đã bắt đầu tải xuống&quot;, Toast.LENGTH_SHORT).show();&#10;            } catch (Exception ex) {&#10;                Toast.makeText(getContext(), &quot;Không thể tải xuống tệp: &quot; + ex.getMessage(), Toast.LENGTH_SHORT).show();&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Public method to allow the activity to request articles reload.&#10;     * Only reloads when this fragment represents the Articles tab (position == 0).&#10;     */&#10;    public void reloadArticles() {&#10;        if (position != 0) return;&#10;        // If adapter or view not ready, set pending flag so it reloads in onCreateView/setupRecyclerView&#10;        if (adapter == null || getView() == null) {&#10;            pendingReload = true;&#10;            return;&#10;        }&#10;        loadArticles();&#10;    }&#10;&#10;    /**&#10;     * Add a newly created article to the top of the list. If adapter isn't ready, queue it.&#10;     */&#10;    public void addArticle(com.example.notby.data.model.Article article) {&#10;        if (article == null || position != 0) return;&#10;        if (adapter == null || getView() == null) {&#10;            pendingAddedArticles.add(article);&#10;            return;&#10;        }&#10;        // ensure we run on UI thread&#10;        if (getActivity() != null) {&#10;            getActivity().runOnUiThread(() -&gt; {&#10;                android.util.Log.d(&quot;LibraryContentFragment&quot;, &quot;Adding article id=&quot; + (article.getId() != null ? article.getId() : &quot;&lt;no-id&gt;&quot;));&#10;                // Check if the article already exists in the adapter&#10;                if (adapter != null &amp;&amp; !adapter.containsArticle(article)) {&#10;                    adapter.addArticleAtFront(article);&#10;                    createdArticlesBuffer.add(0, article);&#10;                }&#10;                if (recyclerView != null) recyclerView.scrollToPosition(0);&#10;            });&#10;        } else {&#10;            android.util.Log.d(&quot;LibraryContentFragment&quot;, &quot;Adding article (no activity) id=&quot; + (article.getId() != null ? article.getId() : &quot;&lt;no-id&gt;&quot;));&#10;        }&#10;    }&#10;&#10;    private void showVideoUploadDialog() {&#10;        View dialogView = LayoutInflater.from(getContext()).inflate(R.layout.dialog_upload_video, null);&#10;&#10;        AlertDialog dialog = new AlertDialog.Builder(requireContext())&#10;            .setView(dialogView)&#10;            .setCancelable(false)&#10;            .create();&#10;&#10;        // Get dialog controls&#10;        android.widget.Button btnSelectVideo = dialogView.findViewById(R.id.btnSelectVideo);&#10;        android.widget.TextView tvSelectedFile = dialogView.findViewById(R.id.tvSelectedFile);&#10;        android.widget.ProgressBar progressBar = dialogView.findViewById(R.id.progressBar);&#10;        android.widget.TextView tvProgress = dialogView.findViewById(R.id.tvProgress);&#10;        android.widget.Button btnCancel = dialogView.findViewById(R.id.btnCancel);&#10;        android.widget.Button btnUpload = dialogView.findViewById(R.id.btnUpload);&#10;&#10;        // Reset state&#10;        selectedVideoUri = null;&#10;        selectedVideoName = null;&#10;&#10;        btnSelectVideo.setOnClickListener(v -&gt; {&#10;            Intent intent = new Intent(Intent.ACTION_GET_CONTENT);&#10;            intent.setType(&quot;video/*&quot;);&#10;            intent.addCategory(Intent.CATEGORY_OPENABLE);&#10;            videoPickerLauncher.launch(Intent.createChooser(intent, &quot;Chọn video&quot;));&#10;        });&#10;&#10;        btnCancel.setOnClickListener(v -&gt; dialog.dismiss());&#10;&#10;        btnUpload.setOnClickListener(v -&gt; {&#10;            if (selectedVideoUri != null &amp;&amp; selectedVideoName != null) {&#10;                btnUpload.setEnabled(false);&#10;                btnSelectVideo.setEnabled(false);&#10;                progressBar.setVisibility(View.VISIBLE);&#10;                tvProgress.setVisibility(View.VISIBLE);&#10;&#10;                videoUploadManager.uploadVideo(selectedVideoUri, selectedVideoName, new VideoUploadManager.VideoUploadCallback() {&#10;                    @Override&#10;                    public void onUploadStart() {&#10;                        requireActivity().runOnUiThread(() -&gt; {&#10;                            tvProgress.setText(&quot;Bắt đầu tải lên...&quot;);&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onUploadProgress(String message) {&#10;                        requireActivity().runOnUiThread(() -&gt; {&#10;                            tvProgress.setText(message);&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onUploadSuccess(MediaFile mediaFile) {&#10;                        requireActivity().runOnUiThread(() -&gt; {&#10;                            dialog.dismiss();&#10;                            Toast.makeText(getContext(), &quot;Tải lên video thành công!&quot;, Toast.LENGTH_SHORT).show();&#10;                            // Refresh the videos list&#10;                            loadVideos();&#10;                        });&#10;                    }&#10;&#10;                    @Override&#10;                    public void onUploadError(String error) {&#10;                        requireActivity().runOnUiThread(() -&gt; {&#10;                            btnUpload.setEnabled(true);&#10;                            btnSelectVideo.setEnabled(true);&#10;                            progressBar.setVisibility(View.GONE);&#10;                            tvProgress.setVisibility(View.GONE);&#10;                            Toast.makeText(getContext(), &quot;Lỗi: &quot; + error, Toast.LENGTH_LONG).show();&#10;                        });&#10;                    }&#10;                });&#10;            }&#10;        });&#10;&#10;        // Listen for video selection result&#10;        getParentFragmentManager().setFragmentResultListener(&quot;video_selected&quot;, this, (requestKey, bundle) -&gt; {&#10;            if (selectedVideoUri != null &amp;&amp; selectedVideoName != null) {&#10;                tvSelectedFile.setText(&quot;Đã chọn: &quot; + selectedVideoName);&#10;                tvSelectedFile.setVisibility(View.VISIBLE);&#10;                btnUpload.setEnabled(true);&#10;            }&#10;        });&#10;&#10;        dialog.show();&#10;&#10;        // Trigger result listener when video is selected&#10;        if (selectedVideoUri != null &amp;&amp; selectedVideoName != null) {&#10;            tvSelectedFile.setText(&quot;Đã chọn: &quot; + selectedVideoName);&#10;            tvSelectedFile.setVisibility(View.VISIBLE);&#10;            btnUpload.setEnabled(true);&#10;        }&#10;    }&#10;&#10;    private String getFileName(Uri uri) {&#10;        String result = null;&#10;        if (uri.getScheme().equals(&quot;content&quot;)) {&#10;            try (android.database.Cursor cursor = requireContext().getContentResolver().query(uri, null, null, null, null)) {&#10;                if (cursor != null &amp;&amp; cursor.moveToFirst()) {&#10;                    int nameIndex = cursor.getColumnIndex(android.provider.OpenableColumns.DISPLAY_NAME);&#10;                    if (nameIndex &gt;= 0) {&#10;                        result = cursor.getString(nameIndex);&#10;                    }&#10;                }&#10;            } catch (Exception e) {&#10;                // Ignore&#10;            }&#10;        }&#10;        if (result == null) {&#10;            result = uri.getPath();&#10;            int cut = result.lastIndexOf('/');&#10;            if (cut != -1) {&#10;                result = result.substring(cut + 1);&#10;            }&#10;        }&#10;        return result != null ? result : &quot;video_&quot; + System.currentTimeMillis() + &quot;.mp4&quot;;&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/item_library_expert.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/item_library_expert.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;androidx.cardview.widget.CardView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;wrap_content&quot;&#10;    android:layout_margin=&quot;8dp&quot;&#10;    app:cardCornerRadius=&quot;8dp&quot;&#10;    app:cardElevation=&quot;4dp&quot;&gt;&#10;&#10;    &lt;LinearLayout&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:orientation=&quot;vertical&quot;&#10;        android:padding=&quot;16dp&quot;&gt;&#10;&#10;        &lt;ImageView&#10;            android:id=&quot;@+id/imageExpert&quot;&#10;            android:layout_width=&quot;80dp&quot;&#10;            android:layout_height=&quot;80dp&quot;&#10;            android:layout_gravity=&quot;center_horizontal&quot;&#10;            android:layout_marginBottom=&quot;8dp&quot;&#10;            android:scaleType=&quot;centerCrop&quot;&#10;            android:src=&quot;@drawable/ic_person&quot;&#10;            android:background=&quot;@drawable/button_background&quot; /&gt;&#10;&#10;        &lt;TextView&#10;            android:id=&quot;@+id/textExpertName&quot;&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:layout_marginBottom=&quot;4dp&quot;&#10;            android:gravity=&quot;center&quot;&#10;            android:textSize=&quot;16sp&quot;&#10;            android:textStyle=&quot;bold&quot;&#10;            android:ellipsize=&quot;end&quot;&#10;            android:maxLines=&quot;2&quot; /&gt;&#10;&#10;        &lt;TextView&#10;            android:id=&quot;@+id/textExpertRole&quot;&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:layout_marginBottom=&quot;4dp&quot;&#10;            android:gravity=&quot;center&quot;&#10;            android:textSize=&quot;14sp&quot;&#10;            android:textColor=&quot;@android:color/darker_gray&quot; /&gt;&#10;&#10;        &lt;TextView&#10;            android:id=&quot;@+id/textExpertEmail&quot;&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:gravity=&quot;center&quot;&#10;            android:textSize=&quot;12sp&quot;&#10;            android:textColor=&quot;@android:color/darker_gray&quot;&#10;            android:ellipsize=&quot;end&quot;&#10;            android:maxLines=&quot;1&quot; /&gt;&#10;&#10;    &lt;/LinearLayout&gt;&#10;&#10;&lt;/androidx.cardview.widget.CardView&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>