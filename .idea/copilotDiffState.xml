<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/notby/data/TokenManager.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/notby/data/TokenManager.java" />
              <option name="originalContent" value="package com.example.notby.data;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;import android.util.Base64;&#10;import org.json.JSONObject;&#10;&#10;public class TokenManager {&#10;    private static final String PREF_NAME = &quot;NotByPrefs&quot;;&#10;    private static final String KEY_JWT_TOKEN = &quot;jwt_token&quot;;&#10;    private static final String KEY_USER_EMAIL = &quot;user_email&quot;;&#10;    private static final String KEY_USER_NAME = &quot;user_name&quot;;&#10;    private static final String KEY_USER_ID = &quot;user_id&quot;;&#10;&#10;    private SharedPreferences sharedPreferences;&#10;    private SharedPreferences.Editor editor;&#10;&#10;    public TokenManager(Context context) {&#10;        sharedPreferences = context.getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);&#10;        editor = sharedPreferences.edit();&#10;    }&#10;&#10;    public void saveToken(String token) {&#10;        editor.putString(KEY_JWT_TOKEN, token);&#10;        editor.apply();&#10;    }&#10;&#10;    public String getToken() {&#10;        return sharedPreferences.getString(KEY_JWT_TOKEN, null);&#10;    }&#10;&#10;    public void saveUserData(String userId, String email, String name) {&#10;        editor.putString(KEY_USER_ID, userId);&#10;        editor.putString(KEY_USER_EMAIL, email);&#10;        editor.putString(KEY_USER_NAME, name);&#10;        editor.apply();&#10;    }&#10;&#10;    public String getUserId() {&#10;        return sharedPreferences.getString(KEY_USER_ID, null);&#10;    }&#10;&#10;    public String getUserEmail() {&#10;        return sharedPreferences.getString(KEY_USER_EMAIL, null);&#10;    }&#10;&#10;    public String getUserName() {&#10;        return sharedPreferences.getString(KEY_USER_NAME, null);&#10;    }&#10;&#10;    public boolean isLoggedIn() {&#10;        return getToken() != null;&#10;    }&#10;&#10;    public void clearSession() {&#10;        editor.clear();&#10;        editor.apply();&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.notby.data;&#10;&#10;import android.content.Context;&#10;import android.content.SharedPreferences;&#10;import android.util.Base64;&#10;import org.json.JSONObject;&#10;&#10;public class TokenManager {&#10;    private static final String PREF_NAME = &quot;NotByPrefs&quot;;&#10;    private static final String KEY_JWT_TOKEN = &quot;jwt_token&quot;;&#10;    private static final String KEY_USER_EMAIL = &quot;user_email&quot;;&#10;    private static final String KEY_USER_NAME = &quot;user_name&quot;;&#10;    private static final String KEY_USER_ID = &quot;user_id&quot;;&#10;    private static final String KEY_CHILD_ID = &quot;child_id&quot;;&#10;&#10;    private SharedPreferences sharedPreferences;&#10;    private SharedPreferences.Editor editor;&#10;&#10;    public TokenManager(Context context) {&#10;        sharedPreferences = context.getSharedPreferences(PREF_NAME, Context.MODE_PRIVATE);&#10;        editor = sharedPreferences.edit();&#10;    }&#10;&#10;    public void saveToken(String token) {&#10;        editor.putString(KEY_JWT_TOKEN, token);&#10;        editor.apply();&#10;    }&#10;&#10;    public String getToken() {&#10;        return sharedPreferences.getString(KEY_JWT_TOKEN, null);&#10;    }&#10;&#10;    public void saveUserData(String userId, String email, String name) {&#10;        editor.putString(KEY_USER_ID, userId);&#10;        editor.putString(KEY_USER_EMAIL, email);&#10;        editor.putString(KEY_USER_NAME, name);&#10;        editor.apply();&#10;    }&#10;&#10;    public String getUserId() {&#10;        return sharedPreferences.getString(KEY_USER_ID, null);&#10;    }&#10;&#10;    public String getUserEmail() {&#10;        return sharedPreferences.getString(KEY_USER_EMAIL, null);&#10;    }&#10;&#10;    public String getUserName() {&#10;        return sharedPreferences.getString(KEY_USER_NAME, null);&#10;    }&#10;&#10;    /**&#10;     * Extract user ID from JWT token&#10;     * @return user ID from token or null if extraction fails&#10;     */&#10;    public String getUserIdFromToken() {&#10;        String token = getToken();&#10;        if (token == null || token.isEmpty()) {&#10;            return null;&#10;        }&#10;        &#10;        try {&#10;            // JWT token has 3 parts separated by dots: header.payload.signature&#10;            String[] tokenParts = token.split(&quot;\\.&quot;);&#10;            if (tokenParts.length != 3) {&#10;                return null;&#10;            }&#10;            &#10;            // Decode the payload (second part)&#10;            String payload = tokenParts[1];&#10;            &#10;            // Add padding if needed for Base64 decoding&#10;            while (payload.length() % 4 != 0) {&#10;                payload += &quot;=&quot;;&#10;            }&#10;            &#10;            // Decode Base64&#10;            byte[] decodedBytes = Base64.decode(payload, Base64.URL_SAFE);&#10;            String decodedPayload = new String(decodedBytes);&#10;            &#10;            // Parse JSON&#10;            JSONObject payloadJson = new JSONObject(decodedPayload);&#10;            &#10;            // Try common user ID field names&#10;            String userId = null;&#10;            if (payloadJson.has(&quot;userId&quot;)) {&#10;                userId = payloadJson.getString(&quot;userId&quot;);&#10;            } else if (payloadJson.has(&quot;user_id&quot;)) {&#10;                userId = payloadJson.getString(&quot;user_id&quot;);&#10;            } else if (payloadJson.has(&quot;id&quot;)) {&#10;                userId = payloadJson.getString(&quot;id&quot;);&#10;            } else if (payloadJson.has(&quot;sub&quot;)) {&#10;                userId = payloadJson.getString(&quot;sub&quot;);&#10;            }&#10;            &#10;            return userId;&#10;            &#10;        } catch (Exception e) {&#10;            return null;&#10;        }&#10;    }&#10;&#10;    public void saveChildId(String childId) {&#10;        editor.putString(KEY_CHILD_ID, childId);&#10;        editor.apply();&#10;    }&#10;&#10;    public String getChildId() {&#10;        return sharedPreferences.getString(KEY_CHILD_ID, null);&#10;    }&#10;&#10;    public boolean isLoggedIn() {&#10;        return getToken() != null;&#10;    }&#10;&#10;    public void clearSession() {&#10;        editor.clear();&#10;        editor.apply();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/values/post_strings.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/values/post_strings.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;resources&gt;&#10;    &lt;!-- Post Detail --&gt;&#10;    &lt;string name=&quot;post_author_format&quot;&gt;By %s&lt;/string&gt;&#10;    &lt;string name=&quot;post_author_anonymous&quot;&gt;By Anonymous&lt;/string&gt;&#10;    &lt;string name=&quot;comment_empty_message&quot;&gt;Please enter a comment&lt;/string&gt;&#10;    &lt;string name=&quot;login_required_message&quot;&gt;Please login to comment&lt;/string&gt;&#10;    &lt;string name=&quot;comment_posted_message&quot;&gt;Comment posted!&lt;/string&gt;&#10;    &lt;string name=&quot;comment_post_failed_message&quot;&gt;Failed to post comment: %s&lt;/string&gt;&#10;    &lt;string name=&quot;comment_post_failed&quot;&gt;Failed to post comment&lt;/string&gt;&#10;    &lt;string name=&quot;comment_liked_message&quot;&gt;Comment liked!&lt;/string&gt;&#10;    &lt;string name=&quot;error_message&quot;&gt;Error: %s&lt;/string&gt;&#10;&lt;/resources&gt;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;resources&gt;&#10;    &lt;!-- Post Detail --&gt;&#10;    &lt;string name=&quot;post_author_format&quot;&gt;By %s&lt;/string&gt;&#10;    &lt;string name=&quot;post_author_anonymous&quot;&gt;By Anonymous&lt;/string&gt;&#10;    &lt;string name=&quot;comment_empty_message&quot;&gt;Please enter a comment&lt;/string&gt;&#10;    &lt;string name=&quot;login_required_message&quot;&gt;Please login to comment&lt;/string&gt;&#10;    &lt;string name=&quot;comment_posted_message&quot;&gt;Comment posted!&lt;/string&gt;&#10;    &lt;string name=&quot;comment_post_failed_message&quot;&gt;Failed to post comment: %s&lt;/string&gt;&#10;    &lt;string name=&quot;comment_post_failed&quot;&gt;Failed to post comment&lt;/string&gt;&#10;    &lt;string name=&quot;comment_liked_message&quot;&gt;Comment liked!&lt;/string&gt;&#10;    &lt;string name=&quot;error_message&quot;&gt;Error: %s&lt;/string&gt;&#10;&lt;/resources&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>